# dashboard_messages_package:
#   template:
#     - sensor:
#       - unique_id: 773874f5-83fb-4ebb-ba67-4bc5fc1ce117
#         name: Dashboard Messages
#         state: >
#           {{
#             this.attributes.items() 
#               | rejectattr('0', 'in', ['icon', 'friendly_name'])
#               | selectattr('1')
#               | list
#               | count
#           }}
#         icon: mdi:text-box-search-outline
#         attributes:
#           # anniversaries: >-
#           #   {%- set days_to_show = 14 %}
#           #   {%-set ns = namespace(a=[], message=[]) %}
#           #   {%- for item in expand(integration_entities('anniversaries'))
#           #     | selectattr('domain', 'eq', 'sensor')
#           #   %}
#           #     {%- set d_h = item.attributes.get('days_until_half_anniversary', 999) %}
#           #     {%- set h = d_h < item.state | int %}
#           #     {%- set d = [item.state | int, d_h] | min %}
#           #     {%- set c = item.attributes.get('current_years') %}
#           #     {%- set y = c if c else none %}
#           #     {%- set y = y + (0.5 if h else 1 if d != 0 else 0) if y is not none %}
#           #     {%- set ns.a = ns.a + [ dict(n=item.name, d=d, y=y, h=h)] %}
#           #   {%- endfor %}
#           #   {%- for item in ns.a | sort(attribute='d') -%}
#           #     {%- set n, d, y = item.n, item.d, item.y %}
#           #     {%- set fixed_icons = {
#           #                             'Eerste date': 'üíï',
#           #                             'Sinterklaas': 'üéÅ'
#           #                           } %}
#           #     {%- set icons = ['ü•≥', 'üéà', 'üç∞', 'üéä', 'üéâ'] %}
#           #     {%- set icon = fixed_icons[n] | default(icons | random, true) %}
#           #     {%- if d <= 1 %}
#           #       {%- if is_state('input_select.dashboard_language', 'EN') %}
#           #         {%- set ns.message = ns.message + [icon ~ [' Today: ', ' Tomorrow '][d] ~ n ~ ((' (' ~ y ~ ' years)') if y)] %}
#           #       {%- else %}
#           #         {%- set ns.message = ns.message + [icon ~ [' Vandaag: ', ' Morgen '][d] ~ n ~ ((' (' ~ y ~ ' jaar)') if y)] %}
#           #       {%- endif %}
#           #     {%- elif d % 7 == 0 and d <= days_to_show %}
#           #       {%- set w = (d / 7) | int  %}
#           #       {%- if is_state('input_select.dashboard_language', 'EN') %}
#           #         {%- set ns.message = ns.message + [icon ~ ' In ' ~ w ~ (' week ' if w == 1 else ' weeks ') ~ ': ' ~ n ~ ((' (' ~ y ~ ' year)') if y)] %}
#           #       {%- else %}
#           #         {%- set ns.message = ns.message + [icon ~ ' Over ' ~ w ~ (' week ' if w == 1 else ' weken ') ~ ': ' ~ n ~ ((' (' ~ y ~ ' jaar)') if y)] %}
#           #       {%- endif %}
#           #     {%- elif d <= days_to_show %}
#           #       {%- if is_state('input_select.dashboard_language', 'EN') %}
#           #         {%- set ns.message = ns.message + [icon ~ ' In ' ~ d ~ ' days' ~': ' ~ n ~ ((' (' ~ y ~ ' years)') if y)] %}
#           #       {%- else %}
#           #         {%- set ns.message = ns.message + [icon ~ ' Over ' ~ d ~ ' dagen' ~': ' ~ n ~ ((' (' ~ y ~ ' jaar)') if y)] %}
#           #       {%- endif %}
#           #     {%- endif %}
#           #   {%- endfor %}
#           #   {{ dict(message=ns.message | join('\n'), level='info') }}
#           # battery: >-
#           #   {% set ns = namespace(message=[]) %}
#           #   {% for item in expand('group.battery_warning') %}
#           #     {%- if item.state | float(21) <= 20 %}
#           #       {%- if is_state('input_select.dashboard_language', 'EN') %}
#           #       {%- set ns.message = ns.message + [ 'The battery of '~ item.name.split(' Battery')[0] ~ ' only has ' ~ item.state ~'%' ] %}
#           #     {%- endif %}
#           #   {% endfor %}
#           #   {{ dict(message=ns.message | join('\n'), level='warning') }}
#           trash: >-
#             {% if not(is_state('sensor.afvalinfo_afval_vandaag', 'none')) and now().hour < 12 %}
#               {% set message = "üóë Garbage day for: " + states('sensor.afvalinfo_afval_vandaag') %}
#             {% elif not(is_state('sensor.afvalinfo_afval_morgen', 'none')) and now().hour > 15 %}
#               {% set message = "üóë Garbage day tomorrow for: " + states('sensor.afvalinfo_afval_morgen') %}
#             {% endif %}
#             {{ dict(message=message | default(''), level='warning' if not is_state('sensor.afvalinfo_afval_vandaag', 'none') else 'info') }}
#           dishwasher: >-
#             {% if is_state('input_boolean.dishwasher_ready_to_start', 'on') %}
#               {% set message = "üçΩÔ∏è Dishwasher will start at " ~ as_local(as_datetime(states('sensor.dishwasher_best_starting_time'))).strftime('%H:%M') %}
#             {% elif is_state('sensor.403010387033006572_bsh_common_status_operationstate', 'BSH.Common.EnumType.OperationState.Run') %}
#               {%- set time_set = as_local(as_datetime(states('sensor.403010387033006572_bsh_common_option_remainingprogramtime'))) %}
#               {%- if now() < time_set %}
#                 {%- set seconds = (time_set - now()).total_seconds() %}
#                 {%- set hours = (seconds / 3600) | int %}
#                 {%- set minutes = (((seconds / 3600) - hours) * 60) | int %}
#                 {%- set program = ct_state_translated("sensor.403010387033006572_selected_program", "en") %}
#                 {%- set message = 'üçΩÔ∏è Dishwasher ready at ' ~ as_local(as_datetime(states('sensor.403010387033006572_bsh_common_option_remainingprogramtime'))).strftime('%H:%M ') ~ '(' ~ program ~ ')' %}
#               {%- else %}
#                 {%- set message = 'üçΩÔ∏è Dishwasher ready any time now' %}
#               {%- endif %}
#             {%- endif %}
#             {{ dict(message=message | default(''), level='info') }}
#           washing_machine: >-
#             {%- if is_state('washing_machine_job_cycle', 'on') %}
#               {%- set h, m, s = states('sensor.wasmachine_remain_time').split(':') | map('int') %}
#               {%- set total = h * 3600 + m *60 %}
#               {%- set message = 'üß∫ Washing machine ready at ' ~ (now() + timedelta(seconds = total)).strftime('%H:%M') %}
#             {%- endif %}
#             {{ dict(message=message | default(''), level='info') }}
#           # eta_sicco: >-
#           #   {% set eta = (state_attr('sensor.variables', 'variables') | default({}, true)).get('eta_martijn', '') %}
#           #   {{ dict(message=eta, level='info') }}
#           # eta_ellen: >-
#           #   {% set eta = (state_attr('sensor.variables', 'variables')| default({}, true)).get('eta_marleen', '') %}
#           #   {{ dict(message=eta, level='info') }}