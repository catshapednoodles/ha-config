central_lights_package:
  template:
    - binary_sensor:
        - name: "Sun low elevation"
          unique_id: sun_low_elevation
          state: >
            {% set cutoff = 6 if states('weather.combined') in ['cloudy', 'fog', 'hail', 'lightning', 'lightning-rainy', 'pouring', 'rainy', 'snowy', 'snowy-rainy'] else 4 %}
            {{ state_attr('sun.sun', 'elevation') < cutoff }}
          icon: "mdi:weather-sunset"
        - name: "Civil twilight"
          unique_id: civil_twilight
          state: >
            {{ state_attr('sun.sun', 'elevation') < -6 }}
          icon: "mdi:weather-sunset-down"

  automation:
    - alias: "Light: Turn off all lights when we leave the house"
      id: 26fbaa60-5a47-49e3-aab1-2fbd655513de
      trigger:
        - platform: state
          entity_id: zone.home
          to: "0"
      condition:
        - condition: state
          entity_id: input_boolean.guest_mode
          state: "off"
      action:
        - service: light.turn_off
          data:
            entity_id: light.inside_lights

    - alias: "Light: Turn off certain lights when the first person leaves"
      id: f086fea2-8ada-4b90-b904-276a67e3291c
      trigger:
      - platform: state
        entity_id: person.sicco
        to: not_home
      - platform: state
        entity_id: person.ellen
        to: not_home
      action:
      - choose:
        - conditions:
            - condition: state
              entity_id: person.ellen
              state: not_home
            - condition: state
              entity_id: input_boolean.sicco_is_sleeping
              state: "on"
          sequence:
            - service: light.turn_off
              data:
                entity_id:
                  - light.ground_floor_lights
                  - light.entryway_ceiling
                  - light.hallway_ceiling
        - conditions:
            - condition: state
              entity_id: person.sicco
              state: not_home
            - condition: state
              entity_id: binary_sensor.ellen_is_sleeping
              state: "on"
          sequence:
            - service: light.turn_off
              data:
                entity_id:
                  - light.ground_floor_lights
                  - light.second_floor_lights
                  - light.entryway_ceiling
                  - light.hallway_ceiling

    # - alias: "Light: Turn off certain automatic lights when guests are home"
    #   id: 7ce6f95a-291f-423a-a9e4-15af52f9a6a9
    #   trigger:
    #     - platform: state
    #       entity_id: input_boolean.guest_mode
    #     - platform: state
    #       entity_id: input_boolean.guest_mode
    #       to: "off"
    #       for:
    #         hours: 8
    #     - platform: state
    #       entity_id:
    #         - input_boolean.automatic_ellens_room_lights
    #         - input_boolean.automatic_game_room_lights
    #       to: "off"
    #       for:
    #         hours: 8
    #   action:
    #     - choose:
    #       - conditions:
    #           - condition: state
    #             entity_id: input_boolean.guest_mode
    #             state: "on"
    #         sequence:
    #           - service: input_boolean.turn_off
    #             data:
    #               entity_id:
    #                 - input_boolean.automatic_ellens_room_lights
    #                 - input_boolean.automatic_game_room_lights
    #       - conditions:
    #           - condition: state
    #             entity_id: input_boolean.guest_mode
    #             state: "off"
    #             for: "08:00:00"
    #         sequence:
    #           - service: input_boolean.turn_on
    #             data:
    #               entity_id:
    #                 - input_boolean.automatic_ellens_room_lights
    #                 - input_boolean.automatic_game_room_lights

    - alias: "Light: Reset automatic lights"
      id: d33767ce-9a06-4b31-ae07-68d2220d94ee
      trigger:
        - platform: state
          entity_id:
            - input_boolean.automatic_attic_lights
            - input_boolean.automatic_bathroom_lights
            - input_boolean.automatic_bedroom_lights
            - input_boolean.automatic_cupboard_lights
            - input_boolean.automatic_ellens_room_lights
            - input_boolean.automatic_entryway_lights
            - input_boolean.automatic_game_room_lights
            - input_boolean.automatic_garage_lights
            - input_boolean.automatic_hallway_lights
            - input_boolean.automatic_kitchen_lights
            - input_boolean.automatic_living_room_lights
            - input_boolean.automatic_office_lights
            - input_boolean.automatic_outside_lights
            - input_boolean.automatic_technical_room_lights
          to: "off"
          for:
            hours: 10
      action:
        - service: input_boolean.turn_on
          data:
            entity_id: "{{ trigger.to_state.entity_id }}"