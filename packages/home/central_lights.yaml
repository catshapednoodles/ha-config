central_lights_package:
  template:
    - binary_sensor:
        - name: "Sun low elevation"
          unique_id: sun_low_elevation
          state: >
            {% set cutoff = 6 if states('weather.combined_daily') in ['cloudy', 'fog', 'hail', 'lightning', 'lightning-rainy', 'pouring', 'rainy', 'snowy', 'snowy-rainy'] else 4 %}
            {{ state_attr('sun.sun', 'elevation') < cutoff }}
          icon: "mdi:weather-sunset"

  automation:
    - alias: "Light: Turn off all lights when we leave the house"
      id: 26fbaa60-5a47-49e3-aab1-2fbd655513de
      trigger:
      - platform: state
        entity_id: zone.home
        to: "0"
      condition:
      - condition: state
        entity_id: input_boolean.guest_mode
        state: "off"
      action:
      - service: light.turn_off
        data:
          entity_id: light.inside_lights

    - alias: "Light: Turn off certain lights when the first person leaves"
      id: f086fea2-8ada-4b90-b904-276a67e3291c
      trigger:
      - platform: state
        entity_id: person.sicco
        to: not_home
      - platform: state
        entity_id: person.ellen
        to: not_home
      action:
      - choose:
        - conditions:
            - condition: state
              entity_id: person.ellen
              state: not_home
            - condition: state
              entity_id: input_boolean.sicco_is_sleeping
              state: "on"
          sequence:
            - service: light.turn_off
              data:
                entity_id: light.ground_floor_lights
            - service: light.turn_off
              data:
                entity_id: light.ellens_room_lights
        - conditions:
            - condition: state
              entity_id: person.sicco
              state: not_home
            - condition: state
              entity_id: binary_sensor.ellen_is_sleeping
              state: "on"
          sequence:
            - service: light.turn_off
              data:
                entity_id: light.ground_floor_lights
