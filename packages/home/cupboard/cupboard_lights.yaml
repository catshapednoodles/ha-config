cupboard_lights_package:
  adaptive_lighting:
  - name: "Cupboard"
    lights:
      - light.cupboard_light
    min_brightness: 50
    max_brightness: 100
    autoreset_control_seconds: 1800
    detect_non_ha_changes: true

  input_boolean:
    automatic_cupboard_lights:
      name: Automatic cupboard lights
      icon: mdi:lightbulb-auto

  automation:
    - alias: "Cupboard: Toggle lights"
      id: b16e1e5c-ec55-45fe-971d-0d6a9af59d76
      mode: queued
      trigger:
        - platform: state
          entity_id: binary_sensor.cupboard_door
          to: "on"
        - platform: state
          entity_id: binary_sensor.cupboard_door
          to: "off"
          for: "00:01:30"
        - platform: state
          entity_id: binary_sensor.cupboard_door
          to: "off"
          for: "00:05:00"
      action:
        - choose:
            # Turn on light when the door is opened
            - conditions:
                - condition: state
                  entity_id: binary_sensor.cupboard_door
                  state: "on"
                - condition: state
                  entity_id: input_boolean.automatic_cupboard_lights
                  state: "on"
              sequence:
                - service: light.turn_on
                  data:
                    entity_id:
                      - light.cupboard_light
            # Turn off lights when the door is closed
            - conditions:
                - condition: state
                  entity_id: binary_sensor.cupboard_door
                  state: "off"
                - condition: state
                  entity_id: input_boolean.automatic_cupboard_lights
                  state: "on"
              sequence:
                - service: light.turn_off
                  data:
                    entity_id:
                      - light.cupboard_light
            - conditions:
                - condition: state
                  entity_id: binary_sensor.cupboard_door
                  state: "off"
                  for: "00:05:00"
              sequence:
                - service: light.turn_off
                  data:
                    entity_id:
                      - light.cupboard_light
                - service: input_boolean.turn_on
                  entity_id: input_boolean.automatic_cupboard_lights

    - alias: "Cupboard: Light switch"
      id: 659927e8-1b3d-4b2c-b42f-d41057f4895b
      description: ''
      use_blueprint:
        path: vandalon/z2m EnOcean PTM 215Z (Friends of Hue) switch.yaml
        input:
          controller: Cupboard Switch
          button_1_pressed:
            - service: light.turn_on
              data: {}
              target:
                entity_id: light.cupboard_light
            - service: input_boolean.turn_off
              entity_id: input_boolean.automatic_cupboard_lights
          button_1_held:
            - service: mqtt.publish
              data:
                topic: zigbee2mqtt/Cupboard Light/set
                payload: "{\"brightness_move_onoff\": 51}"
                qos: 0
                retain: false
          button_1_released:
            - service: mqtt.publish
              data:
                topic: zigbee2mqtt/Cupboard Light/set
                payload: "{\"brightness_move\": \"stop\"}"
                qos: 0
                retain: false
          button_2_pressed:
            - service: light.turn_off
              data: {}
              target:
                entity_id: light.cupboard_light
            - service: input_boolean.turn_off
              entity_id: input_boolean.automatic_cupboard_lights
          button_2_held:
            - service: mqtt.publish
              data:
                topic: zigbee2mqtt/Cupboard Light/set
                payload: "{\"brightness_move_onoff\": -51}"
                qos: 0
                retain: false
          button_2_released:
            - service: mqtt.publish
              data:
                topic: zigbee2mqtt/Cupboard Light/set
                payload: "{\"brightness_move\": \"stop\"}"
                qos: 0
                retain: false