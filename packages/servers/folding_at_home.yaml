folding_at_home_package:
  automation:
    - alias: "Energy: F@H on a day with low average prices"
      id: 93cefca2-67d5-4574-8f1d-6c8ebfda75b2
      mode: single
      trigger:
        - platform: state
          entity_id: sensor.average_electricity_price_today
      condition:
        - condition: numeric_state
          entity_id: sensor.average_electricity_price_today
          below: 0.25
        - condition: time
          before: "06:00:00"
      action:
        - if:
            - condition: state
              entity_id: binary_sensor.folding_home_running
              state: "off"
          then:
            - service: hassio.addon_start
              data:
                addon: foldingathome
            - delay: "00:01:00"
        - service: foldingathomecontrol.unpause
          data:
            address: 192.168.1.2
        - delay: "00:01:00"
        - service: foldingathomecontrol.send_command
          data:
            address: 192.168.1.2
            command: finish

    - alias: "Energy: F@H on a block with low prices"
      id: a91af16b-4931-41dd-8dca-69026a0aadc8
      mode: single
      trigger:
        - platform: time_pattern
          minutes: 0
      condition:
        - condition: template
          value_template: >
            {% set list = state_attr('sensor.nordpool_kwh_nl_eur_3_09_0', 'today')[0:24] %}
            {% if is_state('binary_sensor.electricity_prices_for_tomorrow_available', 'on') %}
              {% set list = list + state_attr('sensor.nordpool_kwh_nl_eur_3_09_0', 'tomorrow')[0:24] %}
            {% endif %}
            {% set hour = now().hour %}
            {% set next_hour_prices = list[hour:hour+5] %}
            {{ next_hour_prices | average < 0.20 }}
        - condition: state
          entity_id: binary_sensor.work_laptop_at_desk_and_active
          state: "off"
      action:
        - service: foldingathomecontrol.unpause
          data:
            address: 192.168.1.4
        - delay: "00:01:00"
        - service: foldingathomecontrol.send_command
          data:
            address: 192.168.1.4
            command: finish
